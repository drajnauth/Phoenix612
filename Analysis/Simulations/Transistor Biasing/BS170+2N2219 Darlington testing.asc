Version 4
SHEET 1 2764 1496
WIRE 464 -176 384 -176
WIRE 624 -176 544 -176
WIRE 720 -176 624 -176
WIRE 624 -160 624 -176
WIRE 384 -128 384 -176
WIRE 720 -112 720 -176
WIRE 384 -32 384 -48
WIRE 512 48 416 48
WIRE 720 48 720 -32
WIRE 720 48 592 48
WIRE 912 48 720 48
WIRE 1040 48 976 48
WIRE 1072 48 1040 48
WIRE 1040 64 1040 48
WIRE 720 80 720 48
WIRE 416 112 416 48
WIRE 416 128 416 112
WIRE 480 128 416 128
WIRE 416 144 416 128
WIRE 1040 160 1040 144
WIRE -64 192 -480 192
WIRE -16 192 -64 192
WIRE 176 192 48 192
WIRE 288 192 176 192
WIRE 352 192 288 192
WIRE -480 224 -480 192
WIRE 176 224 176 192
WIRE 352 224 352 192
WIRE 368 224 352 224
WIRE 720 224 720 160
WIRE 720 240 720 224
WIRE 416 288 416 240
WIRE 416 288 384 288
WIRE 480 288 480 128
WIRE 512 288 480 288
WIRE 640 288 592 288
WIRE 656 288 640 288
WIRE -480 320 -480 304
WIRE -208 336 -256 336
WIRE -112 336 -208 336
WIRE -80 336 -112 336
WIRE 32 336 0 336
WIRE 176 336 176 304
WIRE 176 336 32 336
WIRE 416 352 416 288
WIRE -208 368 -208 336
WIRE 32 368 32 336
WIRE 720 368 720 336
WIRE 720 368 672 368
WIRE 816 368 720 368
WIRE -112 384 -112 336
WIRE 720 384 720 368
WIRE 816 400 816 368
WIRE 32 448 32 432
WIRE -208 464 -208 448
WIRE -112 464 -112 448
WIRE 416 480 416 432
WIRE 720 496 720 464
WIRE 816 496 816 464
WIRE 816 496 720 496
WIRE 720 528 720 496
FLAG 384 -32 0
FLAG -480 320 0
FLAG 416 480 0
FLAG 1072 48 Vout
FLAG 1040 160 0
FLAG 288 192 Vg1
FLAG 384 288 Vs1
FLAG -64 192 Vin
FLAG 416 112 Vd1
FLAG 720 528 0
FLAG 672 368 Ve2
FLAG -352 224 0
FLAG 720 224 Vc2
FLAG 640 288 Vb2
FLAG 624 -96 0
FLAG 720 -176 Vcc
FLAG -112 464 0
FLAG 32 448 0
FLAG -208 464 0
FLAG -256 336 Vbias2
SYMBOL voltage -480 208 R0
WINDOW 0 -45 11 Left 2
WINDOW 3 -214 95 Left 2
WINDOW 123 -214 123 Left 2
WINDOW 39 -214 151 Left 2
SYMATTR InstName V1
SYMATTR Value SINE(0 {S} {F})
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser={Z}
SYMBOL voltage 384 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 12
SYMBOL res 400 336 R0
SYMATTR InstName R4
SYMATTR Value 100
SYMBOL cap 976 32 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value .1µ
SYMBOL res 1024 48 R0
SYMATTR InstName Rout
SYMATTR Value 50
SYMBOL cap 48 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value .1µ
SYMBOL npn 656 240 R0
WINDOW 3 52 62 Left 2
SYMATTR Value 2N3866
SYMATTR InstName Q2
SYMBOL res 704 368 R0
SYMATTR InstName R3
SYMATTR Value 100
SYMBOL res 560 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 45 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 35
SYMBOL cap 800 400 R0
SYMATTR InstName C1
SYMATTR Value .1µ
SYMBOL res 608 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsense2
SYMATTR Value .001
SYMBOL ind 704 -128 R0
SYMATTR InstName L1
SYMATTR Value 33µ
SYMBOL cap 608 -160 R0
WINDOW 3 28 44 Left 2
SYMATTR InstName C2
SYMATTR Value .1µ
SYMBOL res 608 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RsenseQ1
SYMATTR Value .001
SYMBOL res 736 176 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName RsenseQ2
SYMATTR Value .001
SYMBOL nmos 368 144 R0
WINDOW 3 56 60 Left 2
SYMATTR Value BS170
SYMATTR InstName M1
SYMATTR Prefix X
SYMBOL ind2 -96 352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName RFC1
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap -128 384 R0
SYMATTR InstName C5
SYMATTR Value .1µ
SYMBOL cap 16 368 R0
SYMATTR InstName C6
SYMATTR Value .1µ
SYMBOL voltage -208 352 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -60 28 Left 2
WINDOW 3 -86 93 Left 2
SYMATTR InstName V4
SYMATTR Value {BM1}
SYMBOL res 160 208 R0
SYMATTR InstName R1
SYMATTR Value 4.7K
TEXT -384 64 Left 2 !.tran 0 20u
TEXT 1216 -376 Left 2 !.options plotwinsize=0\n.options numdgt = 8\n \n \n.meas TRAN Vinr RMS V(Vin)\n.meas TRAN Voutr RMS V(Vout)\n.meas TRAN Iinr RMS I(V1)\n.meas TRAN Ioutr RMS I(Rout)\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Vgr1 RMS V(Vg1)\n.meas TRAN Vdr1 RMS V(Vd1)\n.meas TRAN Idr1 RMS Ix(M1:D)\n.meas TRAN Igr1 RMS Ix(M1:G)\n.meas TRAN Vgavg1 AVG V(Vg1)\n.meas TRAN Vgmax1 MAX V(Vg1)\n.meas TRAN Vgmin1 MIN V(Vg1)\n.meas TRAN Vbiasr1 RMS V(Vbias1)\n.meas TRAN Vppr1 PARAM Vgmax1-Vgmin1\n.meas TRAN Vpr1 PARAM Vgmax1-Vgs2\n.meas TRAN CdM1 PARAM Vpr1/Vppr1\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Vbr2 RMS V(Vb2)\n.meas TRAN Vcr2 RMS V(Vc2)\n.meas TRAN Ver2 RMS V(Ve2)\n.meas TRAN Ibr2 RMS Ib(Q2)\n.meas TRAN Icr2 RMS Ic(Q2)\n.meas TRAN Ier2 RMS Ie(Q2)\n.meas TRAN Vbavg2 AVG V(Vb2)\n.meas TRAN Vbmax2 MAX V(Vb2)\n.meas TRAN Vbmin2 MIN V(Vb2)\n.meas TRAN Vppr2 PARAM Vbmax2-Vbmin2\n.meas TRAN Vpr2 PARAM Vbmax2-Vbe\n.meas TRAN CdQ2 PARAM Vpr2/Vppr2\n;;;;;;;;;;;;;;;;;;;;;;;;;;; \n.meas TRAN Pdis2 AVG (V(vd2)*Ix(M2:D) + V(vg2)*Ix(M2:G))\n.meas TRAN PdisQ2 AVG (V(Vc2,Ve2)*Ic(Q2) + V(Vb2,Ve2)*Ib(Q2))\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN IsM1 RMS I(RsenseM1)\n.meas TRAN IsQ2 RMS I(RsenseQ2)\n.meas TRAN Is2 RMS I(Rsense2)\n.meas TRAN ZinQ2 PARAM Vbr2/Is2\n.meas TRAN Zin PARAM Vinr/Iinr\n.meas TRAN ZoutM1 PARAM Vsr1/Isr1\n.meas TRAN ZoutQ2 PARAM Vcr2/Icr2\n.meas TRAN CdAngleM1 PARAM CdM1*360\n.meas TRAN CdAngleQ2 PARAM CdQ2*360\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n \n.meas TRAN Pin AVG (Zin*I(V1)*I(V1))\n.meas TRAN Pout AVG (V(Vout)*I(Rout))\n ;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Gq1 PARAM Vsr1/Vgr1\n.meas TRAN Gq2 PARAM Voutr/Vbr2\n.meas TRAN Gvr PARAM Voutr/Vinr\n.meas TRAN Gpr PARAM (Pout/Pin)\n.meas TRAN Gir PARAM (Iinr/Ioutr)\n.meas TRAN Gp PARAM 10*log10(Gpr)\n.meas TRAN Gv PARAM 20*log10(Gvr)\n.meas TRAN Gi PARAM 20*log10(Gir)\n \n.four {F} 4 -1 V(Ve1)\n.four {F} 4 -1 V(Vout)
TEXT -560 -296 Left 2 !;.step param F list 1.5Meg 3.7Meg 5.37Meg 7.1Meg 10.1Meg 14.1Meg 21.1Meg 28.7Meg\n;.step param F list 3.7Meg 14.1Meg 28.7Meg\n.param F 28.7Meg\n;.param R 65 ; for 5V\n.param R 35 ; for 12V\n.param S .06\n.param BM1 3\n.param Z 1\n.param Vbe 0.68\n.param Vgs1 3.6\n.param Vgs2 2.1
TEXT -392 104 Left 2 ;.ac dec 1000 1Meg 30Meg
TEXT 160 432 Left 2 !.include bs170.lib
