Version 4
SHEET 1 4348 1616
WIRE 512 -176 256 -176
WIRE 608 -176 512 -176
WIRE 736 -176 608 -176
WIRE 1248 -176 736 -176
WIRE 1344 -176 1248 -176
WIRE 2208 -176 1344 -176
WIRE 2304 -176 2208 -176
WIRE 512 -160 512 -176
WIRE 736 -160 736 -176
WIRE 1248 -160 1248 -176
WIRE 2208 -160 2208 -176
WIRE 256 -144 256 -176
WIRE 608 -128 608 -176
WIRE 1344 -128 1344 -176
WIRE 2304 -128 2304 -176
WIRE 512 -80 512 -96
WIRE 736 -80 736 -96
WIRE 1248 -80 1248 -96
WIRE 2208 -80 2208 -96
WIRE 256 -48 256 -64
WIRE 1344 -32 1344 -48
WIRE 1344 -32 1232 -32
WIRE 2304 -32 2304 -48
WIRE 2304 -32 2192 -32
WIRE 608 -16 608 -48
WIRE 608 -16 544 -16
WIRE 1232 -16 1232 -32
WIRE 2192 -16 2192 -32
WIRE 544 0 544 -16
WIRE 1472 0 1392 0
WIRE 2432 0 2352 0
WIRE 3968 0 3968 -48
WIRE 1344 48 1344 -32
WIRE 1392 48 1392 0
WIRE 2304 48 2304 -32
WIRE 2352 48 2352 0
WIRE 1232 64 1232 48
WIRE 2192 64 2192 48
WIRE 544 80 544 64
WIRE 1472 112 1472 0
WIRE 1504 112 1472 112
WIRE 1600 112 1568 112
WIRE 1632 112 1600 112
WIRE 1744 112 1712 112
WIRE 1856 112 1744 112
WIRE 2432 112 2432 0
WIRE 2480 112 2432 112
WIRE 2624 112 2544 112
WIRE 2672 112 2624 112
WIRE 672 128 656 128
WIRE 768 128 736 128
WIRE 880 128 848 128
WIRE 944 128 880 128
WIRE 1056 128 1056 48
WIRE 1056 128 1024 128
WIRE 1088 128 1056 128
WIRE 1392 144 1392 128
WIRE 1600 144 1600 112
WIRE 1744 144 1744 112
WIRE 2352 144 2352 128
WIRE 736 160 736 128
WIRE 880 160 880 128
WIRE 1344 160 1344 128
WIRE 1344 160 1280 160
WIRE 2304 160 2304 128
WIRE 2304 160 2240 160
WIRE 2672 160 2672 112
WIRE 608 176 608 -16
WIRE 656 176 656 128
WIRE 1088 240 1088 128
WIRE 1104 240 1088 240
WIRE 1200 240 1168 240
WIRE 1264 240 1200 240
WIRE 1296 240 1264 240
WIRE 1856 240 1856 112
WIRE 1920 240 1856 240
WIRE 2048 240 2048 176
WIRE 2048 240 2000 240
WIRE 2064 240 2048 240
WIRE 2160 240 2128 240
WIRE 2224 240 2160 240
WIRE 2256 240 2224 240
WIRE 1600 256 1600 224
WIRE 1664 256 1600 256
WIRE 1744 256 1744 224
WIRE 1744 256 1664 256
WIRE 656 272 656 256
WIRE 736 272 736 240
WIRE 800 272 736 272
WIRE 880 272 880 240
WIRE 880 272 800 272
WIRE 1200 272 1200 240
WIRE 1664 272 1664 256
WIRE 2160 272 2160 240
WIRE 2672 272 2672 240
WIRE 608 288 608 256
WIRE 608 288 544 288
WIRE 800 288 800 272
WIRE 1344 288 1344 256
WIRE 2304 288 2304 256
WIRE -16 368 -64 368
WIRE 128 368 64 368
WIRE 208 368 128 368
WIRE 336 368 272 368
WIRE 528 368 336 368
WIRE 560 368 528 368
WIRE -64 384 -64 368
WIRE 336 400 336 368
WIRE 608 416 608 384
WIRE -64 480 -64 464
WIRE 1008 496 736 496
WIRE 1056 496 1008 496
WIRE 1200 496 1200 352
WIRE 1200 496 1136 496
WIRE 1984 496 1712 496
WIRE 2016 496 1984 496
WIRE 2160 496 2160 352
WIRE 2160 496 2096 496
WIRE 1008 512 1008 496
WIRE 1200 528 1200 496
WIRE 2160 528 2160 496
WIRE 1984 544 1984 496
WIRE 1008 592 1008 576
WIRE 1200 608 1200 592
WIRE 2160 608 2160 592
WIRE 336 624 336 480
WIRE 400 624 336 624
WIRE 512 624 480 624
WIRE 576 624 512 624
WIRE 624 624 576 624
WIRE 736 624 736 496
WIRE 736 624 624 624
WIRE 1984 624 1984 608
WIRE 336 656 336 624
WIRE 624 656 624 624
WIRE 512 672 512 624
WIRE 736 704 736 624
WIRE 1712 704 1712 496
WIRE 1712 704 736 704
WIRE 336 736 336 720
WIRE 512 752 512 736
WIRE 624 752 624 736
FLAG 256 -48 0
FLAG 2672 272 0
FLAG 2624 112 Vout
FLAG -64 480 0
FLAG 128 368 Vin
FLAG 608 416 0
FLAG 528 368 Vg1
FLAG 544 288 Vd1
FLAG 512 752 0
FLAG 336 736 0
FLAG 624 752 0
FLAG 576 624 Vbias2
FLAG 112 416 0
FLAG 512 -80 0
FLAG 1344 288 0
FLAG 1264 240 Vg2
FLAG 1280 160 Vd2
FLAG 1008 592 0
FLAG 1200 608 0
FLAG 1248 -80 0
FLAG 736 -80 0
FLAG 1056 48 Vs2
FLAG 2304 288 0
FLAG 2224 240 Vg3
FLAG 2240 160 Vd3
FLAG 1984 624 0
FLAG 2160 608 0
FLAG 2208 -80 0
FLAG 2048 176 Vs3
FLAG 800 288 0
FLAG 544 80 0
FLAG 656 272 0
FLAG 1664 272 0
FLAG 1392 144 0
FLAG 1232 64 0
FLAG 2352 144 0
FLAG 2192 64 0
SYMBOL voltage 256 -160 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 12
SYMBOL res 2656 144 R0
SYMATTR InstName Rout
SYMATTR Value 50
SYMBOL voltage -64 368 R0
WINDOW 123 24 124 Left 2
WINDOW 39 24 152 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V5
SYMATTR Value SINE(0 {S} {F})
SYMBOL nmos 560 288 R0
WINDOW 3 56 60 Left 2
SYMATTR Value BS170
SYMATTR InstName M1
SYMATTR Prefix X
SYMBOL res 320 384 R0
SYMATTR InstName R3
SYMATTR Value 4K
SYMBOL cap 2480 128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value .1µ
SYMBOL ind2 384 640 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName RFC2
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap 496 672 R0
SYMATTR InstName C10
SYMATTR Value .1µ
SYMBOL cap 320 656 R0
SYMATTR InstName C11
SYMATTR Value .1µ
SYMBOL voltage 624 640 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value {BM2}
SYMBOL ind2 592 -144 R0
SYMATTR InstName L1
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap 208 384 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C14
SYMATTR Value .1µ
SYMBOL cap 496 -160 R0
SYMATTR InstName C1
SYMATTR Value .1µ
SYMBOL nmos 1296 160 R0
WINDOW 3 56 60 Left 2
SYMATTR Value BS170
SYMATTR InstName M2
SYMATTR Prefix X
SYMBOL res 1184 256 R0
SYMATTR InstName R1
SYMATTR Value 100
SYMBOL ind2 1040 512 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName RFC1
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap 992 512 R0
SYMATTR InstName C2
SYMATTR Value .1µ
SYMBOL cap 1184 528 R0
SYMATTR InstName C3
SYMATTR Value .1µ
SYMBOL ind2 1328 -144 R0
SYMATTR InstName L2
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap 1104 256 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C5
SYMATTR Value .1µ
SYMBOL cap 1232 -160 R0
SYMATTR InstName C6
SYMATTR Value .1µ
SYMBOL cap 720 -160 R0
SYMATTR InstName C7
SYMATTR Value 100µ
SYMBOL res 1040 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 30 56 VTop 2
SYMATTR InstName Rsense2
SYMATTR Value .0001
SYMBOL res 80 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rin
SYMATTR Value {Z}
SYMBOL nmos 2256 160 R0
WINDOW 3 56 60 Left 2
SYMATTR Value BS170
SYMATTR InstName M3
SYMATTR Prefix X
SYMBOL res 2144 256 R0
SYMATTR InstName R2
SYMATTR Value 100
SYMBOL ind2 2000 512 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName RFC3
SYMATTR Value 10µ
SYMATTR Type ind
SYMBOL cap 1968 544 R0
SYMATTR InstName C12
SYMATTR Value .1µ
SYMBOL cap 2144 528 R0
SYMATTR InstName C13
SYMATTR Value .1µ
SYMBOL ind2 2288 -144 R0
SYMATTR InstName L3
SYMATTR Value 66µ
SYMATTR Type ind
SYMBOL cap 2064 256 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C15
SYMATTR Value .1µ
SYMBOL cap 2192 -160 R0
SYMATTR InstName C16
SYMATTR Value .1µ
SYMBOL cap 1504 128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C18
SYMATTR Value .1µ
SYMBOL res 2016 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsense3
SYMATTR Value .0001
SYMBOL ind2 592 160 R0
WINDOW 0 -35 40 Left 2
WINDOW 3 -37 76 Left 2
SYMATTR InstName L4
SYMATTR Value 12µ
SYMATTR Type ind
SYMBOL ind2 640 160 R0
SYMATTR InstName L5
SYMATTR Value 3µ
SYMATTR Type ind
SYMBOL res 864 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 5.6
SYMBOL res 720 144 R0
SYMATTR InstName R5
SYMATTR Value 866
SYMBOL res 864 144 R0
SYMATTR InstName R6
SYMATTR Value 866
SYMBOL cap 736 112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value .1µ
SYMBOL cap 528 0 R0
SYMATTR InstName C9
SYMATTR Value .1µ
SYMBOL res 1728 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 5.6
SYMBOL res 1584 128 R0
SYMATTR InstName R8
SYMATTR Value 866
SYMBOL res 1728 128 R0
SYMATTR InstName R9
SYMATTR Value 866
SYMBOL ind2 1328 32 R0
WINDOW 0 -35 40 Left 2
WINDOW 3 -37 76 Left 2
SYMATTR InstName L6
SYMATTR Value 12µ
SYMATTR Type ind
SYMBOL ind2 1376 32 R0
SYMATTR InstName L7
SYMATTR Value 3µ
SYMATTR Type ind
SYMBOL cap 1216 -16 R0
SYMATTR InstName C17
SYMATTR Value .1µ
SYMBOL ind2 2288 32 R0
WINDOW 0 -35 40 Left 2
WINDOW 3 -37 76 Left 2
SYMATTR InstName L9
SYMATTR Value 12µ
SYMATTR Type ind
SYMBOL ind2 2336 32 R0
SYMATTR InstName L10
SYMATTR Value 3µ
SYMATTR Type ind
SYMBOL cap 2176 -16 R0
SYMATTR InstName C20
SYMATTR Value .1µ
TEXT 2912 -576 Left 2 !.options plotwinsize=0\n.options numdgt = 8\n \n.meas TRAN Vinr RMS V(Vin)\n.meas TRAN Voutr RMS V(Vout)\n.meas TRAN Iinr RMS I(Rin)\n.meas TRAN Ioutr RMS I(Rout)\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Vgr1 RMS V(Vg1)\n.meas TRAN Vdr1 RMS V(Vd1)\n.meas TRAN Idr1 RMS Ix(M1:D)\n.meas TRAN Igr1 RMS Ix(M1:G)\n.meas TRAN Vgavg1 AVG V(Vg1)\n.meas TRAN Vgmax1 MAX V(Vg1)\n.meas TRAN Vgmin1 MIN V(Vg1)\n.meas TRAN Vbiasr1 RMS V(Vbias2)\n.meas TRAN Vppr1 PARAM Vgmax1-Vgmin1\n.meas TRAN Vpr1 PARAM Vgmax1-Vgs2\n.meas TRAN Cd1 PARAM Vpr1/Vppr1\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Vgr2 RMS V(Vg2)\n.meas TRAN Vdr2 RMS V(Vd2)\n.meas TRAN Idr2 RMS Ix(M2:D)\n.meas TRAN Igr2 RMS Ix(M2:G)\n.meas TRAN Vgavg2 AVG V(Vg2)\n.meas TRAN Vgmax2 MAX V(Vg2)\n.meas TRAN Vgmin2 MIN V(Vg2)\n.meas TRAN Vbiasr2 RMS V(Vbias2)\n.meas TRAN Vppr2 PARAM Vgmax2-Vgmin2\n.meas TRAN Vpr2 PARAM Vgmax2-Vgs2\n.meas TRAN Cd2 PARAM Vpr2/Vppr2\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Vgr3 RMS V(Vg3)\n.meas TRAN Vdr3 RMS V(Vd3)\n.meas TRAN Idr3 RMS Ix(M3:D)\n.meas TRAN Igr3 RMS Ix(M3:G)\n.meas TRAN Vgavg3 AVG V(Vg3)\n.meas TRAN Vgmax3 MAX V(Vg3)\n.meas TRAN Vgmin3 MIN V(Vg3)\n.meas TRAN Vbiasr3 RMS V(Vbias2)\n.meas TRAN Vppr3 PARAM Vgmax3-Vgmin3\n.meas TRAN Vpr3 PARAM Vgmax3-Vgs2\n.meas TRAN Cd3 PARAM Vpr3/Vppr2\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Pdis1 AVG (V(vd1)*Ix(M1:D) + V(vg1)*Ix(M1:G))\n.meas TRAN Pdis2 AVG (V(vd2)*Ix(M2:D) + V(vg2)*Ix(M2:G))\n.meas TRAN Pdis3 AVG (V(vd3)*Ix(M3:D) + V(vg3)*Ix(M3:G))\n;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN Isr2 RMS I(Rsense2)\n.meas TRAN Vsr2 RMS V(Vs2)\n.meas TRAN Isr3 RMS I(Rsense3)\n.meas TRAN Vsr3 RMS V(Vs3)\n.meas TRAN Zin PARAM Vinr/Iinr\n.meas TRAN Zout PARAM Vdr3/Idr3\n.meas TRAN ZinM2 PARAM Vsr2/Isr2\n.meas TRAN ZinM3 PARAM Vsr3/Isr3\n.meas TRAN ZoutM1 PARAM Vdr1/Idr1\n.meas TRAN ZoutM2 PARAM Vdr2/Idr2\n.meas TRAN ZoutM3 PARAM Vdr3/Idr3\n.meas TRAN CdAngle1 PARAM Cd1*360\n.meas TRAN CdAngle2 PARAM Cd2*360\n.meas TRAN CdAngle3 PARAM Cd3*360\n.meas TRAN Pin RMS (V(Vin)*I(Rin))\n.meas TRAN Pout AVG (V(Vout)*I(Rout))\n.meas TRAN Pdis PARAM Pdis2+Pdis1\n.meas TRAN Pmar PARAM Pout-Pdis\n ;;;;;;;;;;;;;;;;;;;;;;;;;;;\n.meas TRAN GM1 PARAM (Vsr2/Vinr)\n.meas TRAN GM2 PARAM (Vsr3/Vsr2)\n.meas TRAN GM3 PARAM (Voutr/Vsr3)\n.meas TRAN Gpr PARAM (Pout/Pin)\n.meas TRAN Gvr PARAM (Voutr/Vinr)\n.meas TRAN Gp PARAM 10*log10(Gpr)\n.meas TRAN Gv PARAM 20*log10(Gvr)\n.meas TRAN Gi PARAM 20*log10(Ioutr/Iinr)\n.meas TRAN Beta2 PARAM Idr2/Igr2\n \n.four {F} 4 -1 V(Vout)
TEXT -144 -272 Left 2 !;.step param F list 1.5Meg 3.7Meg 5.37Meg 7.1Meg 10.1Meg 14.1Meg 21.1Meg 28.7Meg\n;.step param F list  3.7Meg 14.1Meg 28.7Meg\n.param F 28.7Meg\n.param S .01\n.param BM2 3\n;.step param BM2 2.2 4 .2\n;.step param R 50 500 50\n.param Z 50\n.param Vgs1 3.6\n.param Vgs2 2.1
TEXT 536 464 Left 2 !.include bs170.lib
TEXT 96 312 Left 2 ;50 Zin
TEXT 1312 -312 Left 2 !.tran 0 20u
TEXT 480 144 Left 2 !K1 L4 L5 1
TEXT 1400 -24 Left 2 !K2 L6 L7 1
TEXT 2352 -24 Left 2 !K3 L9 L10 1
